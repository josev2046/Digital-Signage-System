@startuml
skinparam sequenceMessageAlign center
skinparam roundCorner 5
skinparam participantPadding 20
skinparam boxPadding 10
skinparam ArrowColor DimGray
skinparam HyperlinkColor blue
skinparam lifelineStrategy solid
skinparam ParticipantFontStyle Bold

participant "Cron Scheduler" as Cron #LightBlue
participant "Digital Signage Script\n(Python)" as Script #LightGreen
database "Pi Local Storage" as Storage #LightYellow
participant "Vimeo API" as Vimeo #Lavender
participant "Existing MPV Process" as OldMPV #LightSalmon
participant "New MPV Process" as NewMPV #LightGreen

autonumber

box "Morning Refresh Cycle" 
    Cron -> Script: **Execute Daily (e.g., 6:00 AM)**
    activate Script

    Script -> OldMPV: **Stop (kill) instances**
    activate OldMPV
    OldMPV --> Script: Termination signal received
    deactivate OldMPV
    destroy OldMPV

    Script -> Storage: **Clear All Videos**
    Script -> Vimeo: **Request Latest Video Metadata**
    activate Vimeo
    Vimeo --> Script: Video Metadata (URL, ID)
    deactivate Vimeo

    alt If Content Available
        Script -> Vimeo: **Download Video File**
        activate Vimeo
        Vimeo --> Script: Video Data Stream
        deactivate Vimeo
        Script -> Storage: **Save Video File**
        Script -> Script: **Generate MPV Playlist**
        Script -> NewMPV: **Launch Player (Detached)**
        activate NewMPV
        Script --> Cron: Script Finishes
        deactivate Script
    else No Content / Download Error
        Script --> Cron: Script Finishes (No Playback)
        deactivate Script
    end
end box

group "Continuous Playback Loop" 
    NewMPV -> Storage: **Read Video from Playlist**
    loop Indefinitely
        NewMPV -> NewMPV: **Decode & Render Video to Display**
    end loop
    NewMPV -> NewMPV: **Loops back to start of playlist**
end group

Cron -> Cron: **Wait for Next Daily Trigger (24 hours later)**
' The entire cycle repeats
@enduml
